# Nome do Workflow
name: ðŸš€ Deploy Suzi Artesanatos to Fly.io

# Define quando este workflow serÃ¡ executado
on:
  # Executa toda vez que houver um push para a branch 'main'
  push:
    branches: ["main"]
  # Permite executar manualmente a partir da interface do GitHub
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Puxa o cÃ³digo do repositÃ³rio (NecessÃ¡rio para acessar fly.toml e Dockerfile)
      - name: ðŸ“¦ Checkout do RepositÃ³rio
        uses: actions/checkout@v4
        
      # 2. Build e Deploy para o Fly.io usando a action oficial
      # O Dockerfile farÃ¡ a instalaÃ§Ã£o das dependÃªncias (npm ci) e o build, 
      # ignorando o erro de dependÃªncia que ocorreu no runner.
      - name: ðŸš€ Fazer Deploy no Fly.io
        uses: superfly/flyctl-actions@master
        with:
          # ForÃ§ando o uso do Dockerfile
          args: deploy --dockerfile ./Dockerfile
        env:
          # ðŸš¨ SECRETS CRUCIAIS:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }} 
          
          # Estes sÃ£o injetados na sua aplicaÃ§Ã£o Next.js
          ADMIN_USER: ${{ secrets.ADMIN_USER }}
          ADMIN_PASS: ${{ secrets.ADMIN_PASS }}
          NODE_ENV: production
